#!/usr/bin/env node

"use strict";

require("colors");
const optimist = require("optimist");
const argv = optimist
  .usage("$0 [-h] -i <input>".yellow)
  .option("h", {
    alias: "help",
    description: "Show usage"
  })
  .option("i", {
    alias: "input",
    description: "Input directory"
  })
  .boolean(["h"])
  .string(["i"])
  .argv;

const MetaDataSync = require("./lib/sync").MetaDataSync;
const server = require("./lib/server");

if (argv.help || !("input" in argv)) {
  console.log(optimist.help());
  process.exit();
}

const inputDir = argv.input;
let meta = new MetaDataSync(inputDir);
meta.sync()
    .then(server.createServer)
    .catch((err) => console.error(err.stack));
